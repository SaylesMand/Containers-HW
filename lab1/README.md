## Плохие практики в [Dockerfile.bad](Dockerfile.bad):

### 1. Использование тега `latest`
- **Недетерминированность**: Версия образа может меняться
- **Невозможность воспроизведения**: Нельзя откатиться к старой рабочей версии
- **Размер**: Обычно `latest` - максимальный образ, не минимальный

### 2. Работа от имени `root`
- **Уязвимость**: Компрометация контейнера = root на хосте
- **Права файлов**: Все файлы создаются от root, проблемы с доступом

### 3. `COPY . .` без `.dockerignore`
- **Секреты**: Могут попасть `.env`, ключи, пароли
- **Мусор**: `.git`, `__pycache__`, `logs/` увеличивают образ

### 4. `VOLUME` в Dockerfile
- **Автоматическое создание**: Том создаётся всегда, даже если не нужен
- **Потеря контроля**: Нельзя наполнить данными при монтировании внешнего тома

### 5. Неэффективные `RUN` инструкции
- **Много слоёв**: `apt-get update` и `install` в разных RUN = 2 слоя
- **Кэш не очищен**: `/var/lib/apt/lists/*` остаётся

### 6. Нарушен порядок инструкций
- **Инвалидация кэша**: Изменение кода -> переустановка пакетов
- **Сборка медленнее**: Пакеты устанавливаются каждый раз при изменении кода

### 7. Отсутствие `.dockerignore`
- **Утечка данных**: Все файлы контекста попадают в образ
- **Увеличение размера**: Временные файлы, логи, кэши  

## Исправления в [Dockerfile.good](Dockerfile.good)

### 1. Использование тега `latest`
- **Исправлено:** Фиксированная версия `apache/airflow:slim-3.1.3-python3.12`.

### 2. Работа от имени `root`
- **Исправлено:** Переходим на `USER root` только на время `apt-get`, затем `USER airflow`. Файлы копируем с `--chown=airflow:root`.

### 3. `COPY . .` без `.dockerignore`
- **Исправлено:** Заменено на точечные COPY только нужных директорий (dags, plugins). Добавлен `.dockerignore`, чтобы секреты, `.git`, кэши и прочий мусор не попадали в образ и не раздували контекст.

### 4. `VOLUME` в Dockerfile
- **Исправлено:** Убрали `VOLUME`. Том(а) описываем на уровне `docker run/docker-compose`. Можно подмонтировать внешние тома и предварительно наполнить их данными.

### 5. Неэффективные `RUN` инструкции
- **Исправлено:** Объединили `apt-get update` и `install` в один `RUN`. Чистим кэш `apt`: `rm -rf /var/lib/apt/lists/*`. Используем `--no-install-recommends`, чтобы не тащить лишние зависимости.

### 6. Нарушен порядок инструкций
- **Исправлено:** Сначала ставим системные пакеты (меняются редко), потом копируем код (меняется часто). Это сохраняет слои кэша: при изменении DAG’ов пакеты не переустанавливаются.

### 7. Отсутствие `.dockerignore`
- **Исправлено:** Добавлен `.dockerignore`, чтобы не утягивать в образ лишнее и не рисковать секретами.